<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:camel="http://camel.apache.org/schema/spring"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">

  <camelContext xmlns="http://camel.apache.org/schema/spring">
    <packageScan>
        <package>se.rl.tickergateway</package>
    </packageScan>
    <route id="ReutersGateway">
        <from uri="file:src/data/reuters?noop=true"/>
        <split>
            <tokenize token="\n"></tokenize>
            <log message="Ticker from reuters ${body}"/>
            <unmarshal>
                <csv delimiter=","/>
            </unmarshal>
            <to uri="freemarker:transform/reutersToCanonical.ftl"/>
            <setHeader headerName="from">
                <constant>Reuters</constant>
            </setHeader>
            <to uri="activemq:queue:ticker"/>
        </split>
    </route>
</camelContext>


   <bean id="jmsConnectionFactory" class="org.apache.activemq.ActiveMQConnectionFactory">
     <property name="brokerURL" value="tcp://localhost:61616" />
   </bean>
	
	<bean id="activemq" class="org.apache.activemq.camel.component.ActiveMQComponent">
	    <property name="connectionFactory" ref="jmsConnectionFactory"/>
	</bean>
	
  <!-- Required to find CXF http transport etc for Nasdaq WS gateway.. -->
  <import resource="classpath:META-INF/cxf/cxf.xml"/>
</beans>
